<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-US" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Buffer Overflows and The Virtual memory layout - PD @0xd4ngi</title>
<meta name="description" content="To understand Stack-buffer-overflow attack in the virtual memory">


  <meta name="author" content="Prashant Dangi">
  
  <meta property="article:author" content="Prashant Dangi">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="PD @0xd4ngi">
<meta property="og:title" content="Buffer Overflows and The Virtual memory layout">
<meta property="og:url" content="http://localhost:4000/binary-exploitation/virtual-memory-layout/">


  <meta property="og:description" content="To understand Stack-buffer-overflow attack in the virtual memory">





  <meta name="twitter:site" content="@0xd4ngi">
  <meta name="twitter:title" content="Buffer Overflows and The Virtual memory layout">
  <meta name="twitter:description" content="To understand Stack-buffer-overflow attack in the virtual memory">
  <meta name="twitter:url" content="http://localhost:4000/binary-exploitation/virtual-memory-layout/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2025-01-09T00:00:00+05:30">





  

  


<link rel="canonical" href="http://localhost:4000/binary-exploitation/virtual-memory-layout/">







  <meta name="google-site-verification" content="google5b5d5f22cf1b535d.html" />






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="PD @0xd4ngi Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          PD @0xd4ngi
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/hackspot/"
                
                
              >HackSpot</a>
            </li><li class="masthead__menu-item">
              <a
                href="/archive/"
                
                
              >Archive</a>
            </li><li class="masthead__menu-item">
              <a
                href="/about/"
                
                
              >About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/assets/images/oooo.webp" alt="Prashant Dangi" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Prashant Dangi</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Hi, I am a Security Researcher with a passion for cybersecurity and low level codes.<br /><br />I generally works with C, Pyhton and Assembly, working with Hardware level code and Linux binaries. <br /><br />What you’ll find on this page:<br />Binary Exploitation<br />Reverse Engineering<br />Linux (x86_64)</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="mailto:prashantdangi983@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://prashantdangi.github.io" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/prashantdangi983/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://x.com/0xd4ngi" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/prashantdangi" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Buffer Overflows and The Virtual memory layout">
    <meta itemprop="description" content="To understand Stack-buffer-overflow attack in the virtual memory">
    <meta itemprop="datePublished" content="2025-01-09T00:00:00+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="http://localhost:4000/binary-exploitation/virtual-memory-layout/" itemprop="url">Buffer Overflows and The Virtual memory layout
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#what-is-virtual-memory-layout">What is Virtual Memory Layout</a></li><li><a href="#parts-of-virtual-memory-address">Parts of Virtual Memory Address</a></li><li><a href="#stack-expands-in-opposite-dirction-to-the-data-text-and-heap">Stack expands in opposite dirction to the data, text and Heap</a><ul><li><a href="#the-call-stack-and-x86_64-calling-convention">The Call Stack and x86_64 Calling Convention</a></li><li><a href="#function-stacks">Function Stacks</a><ul><li><a href="#what-happens-when-we-call-a-function">What happens when we call a function</a></li><li><a href="#now-what-happens-when-exiting-a-function">Now What happens when exiting a function</a></li></ul></li></ul></li><li><a href="#buffer-overflow">Buffer Overflow</a></li></ul>
            </nav>
          </aside>
        
        <h1 id="what-is-virtual-memory-layout">What is Virtual Memory Layout</h1>

<p>Operating System manages memory for programs using virtual memory, which is referred as the <strong>virtual memory layout</strong>. Programs are given their own virtual address space, isolating them from other programs.</p>

<p>Below is the representation of the Virtual memory layout</p>

<p><img src="/assets/images/Virtual_memory_layout.png" alt="Virtual memory layout" /></p>

<h1 id="parts-of-virtual-memory-address">Parts of Virtual Memory Address</h1>

<p>This layout typically includes:</p>

<ul>
  <li><strong>Text Segment :</strong> Holds Compiled Program code.</li>
  <li><strong>Data Segment :</strong> Holds global and static variables.</li>
  <li>
    <p><strong>Heap :</strong> For Dynamically allocated memory during runtime</p>

    <p><strong>and</strong></p>
  </li>
  <li><strong>The Stack :</strong> For local variables, function calls and control flow</li>
</ul>

<h1 id="stack-expands-in-opposite-dirction-to-the-data-text-and-heap">Stack expands in opposite dirction to the data, text and Heap</h1>

<h2 id="the-call-stack-and-x86_64-calling-convention">The Call Stack and x86_64 Calling Convention</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function one(){
    two();
}

function two(){
    three();
}

function three(){
    console.trace("Call Stack");
}
</code></pre></div></div>

<p>function three() execute firsts then –&gt; two() then –&gt; one()</p>

<p><img src="/assets/images/function.png" alt="" /></p>

<p>When a new function is called, we create a new function stack at the top, and pop it off when we are done. All programs are linear like this, you must pop off the top function before revisiting the data contained in the previous functions. If we want to fetch data from other function, it must be <strong>global(.bss or .data)</strong> and not on Stack.</p>

<h2 id="function-stacks">Function Stacks</h2>

<blockquote>
  <p>Opcode/Operational Code: Single instruction executed by CPU</p>
  <blockquote>
    <p>RBP: Base pointer in x86_64<br />
RSP: Stack pointer in x86_64<br />
RIP: Instruction register in x86_64</p>
  </blockquote>
</blockquote>

<p><img src="/assets/images/functioncall.png" alt="" /></p>

<p>For Setting up the Function Stack, All the parameters are placed in appropriate registers</p>

<h3 id="what-happens-when-we-call-a-function">What happens when we call a function</h3>

<ul>
  <li>Opcode “call” pushes the return address onto the stack,</li>
  <li>Opcode “push” pushes RBP onto the stack,</li>
  <li>Opcode “mov” moves RSP to RBP</li>
</ul>

<p><strong>This sets up the stack frame for new function</strong></p>

<h3 id="now-what-happens-when-exiting-a-function">Now What happens when exiting a function</h3>

<ul>
  <li>Setting RAX register to desired value,</li>
  <li>Opcode “mov” or “leave” sets RSP to RBP,</li>
  <li>Opcode “pop” pops saved base pointer into RBP</li>
  <li>Opcode “ret” pops return address into RIP, redirects code execution</li>
</ul>

<h1 id="buffer-overflow">Buffer Overflow</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdio.h&gt;

int main(){
    long overflow_me = 0;
    char buf[0x20]; //0x20 = 32 bits

    gets(buf);

    printf("%ld\n", overflow_me);

    return 0;
}

</code></pre></div></div>

<p>In this program get(buf) is set to take only 32 bits of data, but there is no limitation that the code will only take 32 bits of data and not more than that, if we provide more data (there is no mitigation to that here). So,</p>

<p>Overwriting the return address and base pointer messes up the execution of the program and the code gets corrupted causing <strong>Buffer Overflow</strong></p>

<p>For Example :</p>

<p>In this code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void win(){
    printf("You win! If you get here\n");
}

int main(){
    char buf[32];
    
    gets(buf);

    return 0;
}
</code></pre></div></div>

<p>Just like before it can accept 32 bits of data. but if we provide it with more than 32 bits of data it overwrites the base pointer. And now we can go to our intended destination (win offset)</p>

<p><img src="/assets/images/offset.png" alt="" /></p>

<p><strong>If memory can be corrupted through a vulnerability, control flow and data in memory can be manipulated</strong></p>

        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#binary-exploitation" class="page__taxonomy-item p-category" rel="tag">binary-exploitation</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-01-09T00:00:00+05:30">January 9, 2025</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=0xd4ngi&text=Buffer+Overflows+and+The+Virtual+memory+layout%20http%3A%2F%2Flocalhost%3A4000%2Fbinary-exploitation%2Fvirtual-memory-layout%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fbinary-exploitation%2Fvirtual-memory-layout%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/binary-exploitation/virtual-memory-layout/" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/llm/" class="pagination--pager" title="Understanding Large Language models(LLMs)
">Previous</a>
    
    
      <a href="/phishing/paypal-phishing/" class="pagination--pager" title="PayPal Phishing with PayPal URL
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/phishing/paypal-phishing/" rel="permalink">PayPal Phishing with PayPal URL
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Attackers using sophisticated attacks to bypass login security
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/llm/" rel="permalink">Understanding Large Language models(LLMs)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">“Machine Learning Models that use deep learning to perform Natural Language Processing(NLP) tasks”
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/rag/" rel="permalink">Retrieval Augmented Generation(RAG) is a threat to AI
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Some concern and risks associated with RAG that could perceived as threats, in areas related to AI safety and misuse
</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/LLM-OWASP-top-10/" rel="permalink">LLM OWASP TOP 10 vulnerabilities
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">LLM1:2025 Prompt Injection/Jailbreaking
</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto:prashantdangi983@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://prashantdangi.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://github.com/prashantdangi" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/prashantdangi983/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="https://x.com/0xd4ngi" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="http://localhost:4000">PD @0xd4ngi</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/binary-exploitation/virtual-memory-layout/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/binary-exploitation/virtual-memory-layout"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://0xd4ngi.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  




  </body>
</html>
